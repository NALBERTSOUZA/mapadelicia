<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Mapa de Mesas</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{margin:0;font-family:Arial;background:#f4f6fb}
header{
  height:60px;background:#fff;display:flex;align-items:center;
  justify-content:space-between;padding:0 20px;border-bottom:1px solid #ddd
}
.actions{display:flex;gap:10px;align-items:center}
button{padding:8px 14px;border:none;border-radius:6px;background:#111827;color:#fff;font-weight:600;cursor:pointer}

.toggle{width:60px;height:30px;background:#dc2626;border-radius:30px;position:relative;cursor:pointer}
.toggle::after{content:'';width:24px;height:24px;background:#fff;border-radius:50%;position:absolute;top:3px;left:33px;transition:.2s}
.toggle.on{background:#16a34a}
.toggle.on::after{left:3px}

#canvas{position:relative;height:calc(100vh - 60px)}

.mesa{
  position:absolute;background:#e5e7eb;border:3px solid #9ca3af;
  border-radius:8px;cursor:grab
}
.mesa.reservada{border-color:#16a34a}

.resize{
  width:12px;height:12px;background:#111827;
  position:absolute;right:-6px;bottom:-6px;cursor:se-resize
}

.cadeira{
  position:absolute;width:26px;height:10px;
  background:#111827;border-radius:6px
}

.elemento{
  position:absolute;background:#9ca3af
}
.linha{height:4px;width:120px}
.degrau{height:20px;width:60px;background:#6b7280}

/* MODAL */
.modal{
  position:fixed;inset:0;background:rgba(0,0,0,.4);
  display:none;align-items:center;justify-content:center;z-index:10
}
.modal-box{
  background:#fff;padding:20px;width:320px;border-radius:10px
}
.modal-box label{display:block;margin-top:10px}
.modal-box input,select{width:100%;padding:8px;margin-top:4px}
.modal-actions{display:flex;justify-content:flex-end;gap:10px;margin-top:15px}
.warn{color:#dc2626;font-size:12px;margin-top:6px}
</style>
</head>

<body>

<header>
  <strong id="label">Editar</strong>
  <div class="actions">
    <button id="btnMesa">+ Mesa</button>
    <button id="btnLinha">+ Linha</button>
    <button id="btnDegrau">+ Degrau</button>
    <div id="toggle" class="toggle on"></div>
  </div>
</header>

<div id="canvas"></div>

<!-- MODAL MESA -->
<div class="modal" id="modalMesa">
  <div class="modal-box">
    <h3>Nova Mesa</h3>
    <label>Cadeiras</label>
    <input type="number" id="qtdCadeiras" value="4" min="2">
    <div class="modal-actions">
      <button onclick="fecharMesa()">Cancelar</button>
      <button onclick="criarMesa()">Criar</button>
    </div>
  </div>
</div>

<!-- MODAL RESERVA -->
<div class="modal" id="modalReserva">
  <div class="modal-box">
    <h3>Reserva</h3>
    <label>Cliente</label>
    <input id="cliente">
    <label>Telefone</label>
    <input id="telefone">
    <label>Lugares</label>
    <input type="number" id="lugares">
    <div id="aviso" class="warn" style="display:none">
      Quantidade maior que os assentos da mesa.<br>
      Você poderá juntar outra mesa depois.
    </div>
    <div class="modal-actions">
      <button onclick="fecharReserva()">Cancelar</button>
      <button onclick="salvarReserva()">Salvar</button>
    </div>
  </div>
</div>

<script>
let modoEditar=true;
const canvas=document.getElementById('canvas');
const toggle=document.getElementById('toggle');
const label=document.getElementById('label');
const modalMesa=document.getElementById('modalMesa');
const modalReserva=document.getElementById('modalReserva');
let mesaAtual=null;

/* SWITCH */
toggle.onclick=()=>{
  modoEditar=!modoEditar;
  toggle.classList.toggle('on',modoEditar);
  label.innerText=modoEditar?'Editar':'Ao vivo';
  document.querySelectorAll('button').forEach(b=>{
    if(b.id!=='toggle') b.style.display=modoEditar?'inline-block':'none';
  });
};

/* ELEMENTOS */
btnLinha.onclick=()=>addElemento('linha');
btnDegrau.onclick=()=>addElemento('degrau');

function addElemento(tipo){
  if(!modoEditar) return;
  const el=document.createElement('div');
  el.className=`elemento ${tipo}`;
  el.style.left='200px';el.style.top='200px';
  drag(el);
  canvas.appendChild(el);
}

/* MESA */
btnMesa.onclick=()=>modalMesa.style.display='flex';
function fecharMesa(){modalMesa.style.display='none'}

function criarMesa(){
  const qtd=+qtdCadeiras.value;
  const m=document.createElement('div');
  m.className='mesa';
  m.style.width='140px';m.style.height='80px';
  m.style.left='200px';m.style.top='200px';
  m.dataset.cadeiras=qtd;

  for(let i=0;i<qtd;i++){
    const c=document.createElement('div');
    c.className='cadeira';
    c.style.left=(20+i*25)+'px';
    c.style.top='-15px';
    m.appendChild(c);
  }

  const r=document.createElement('div');
  r.className='resize';
  m.appendChild(r);
  resize(m,r);
  drag(m);

  m.ondblclick=e=>{
    if(!modoEditar) return;
    mesaAtual=m;
    modalReserva.style.display='flex';
  };

  canvas.appendChild(m);
  fecharMesa();
}

/* RESERVA */
function fecharReserva(){modalReserva.style.display='none'}

lugares.oninput=()=>{
  aviso.style.display=+lugares.value > +mesaAtual.dataset.cadeiras ? 'block':'none';
};

function salvarReserva(){
  mesaAtual.classList.add('reservada');
  fecharReserva();
}

/* DRAG */
function drag(el){
  let m=false,ox,oy;
  el.onmousedown=e=>{
    if(!modoEditar)return;
    m=true;ox=e.offsetX;oy=e.offsetY;
  };
  document.onmousemove=e=>{
    if(!m)return;
    el.style.left=(e.pageX-ox)+'px';
    el.style.top=(e.pageY-oy-60)+'px';
  };
  document.onmouseup=()=>m=false;
}

/* RESIZE */
function resize(m,handle){
  let r=false;
  handle.onmousedown=e=>{
    e.stopPropagation();
    r=true;
  };
  document.onmousemove=e=>{
    if(!r)return;
    m.style.width=(e.pageX-m.offsetLeft)+'px';
    m.style.height=(e.pageY-m.offsetTop-60)+'px';
  };
  document.onmouseup=()=>r=false;
}
</script>

</body>
</html>
