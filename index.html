<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Mapa de Mesas ‚Ä¢ Restaurante</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --bg:#f4f6f8;
  --primary:#2563eb;
  --border:#dcdfe4;
  --green:#16a34a;
  --chair:#111827;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:Inter, Arial, sans-serif;
  background:var(--bg);
  display:flex;
  height:100vh;
}

/* SIDEBAR */
aside{
  width:280px;
  background:#0f172a;
  color:#fff;
  padding:20px;
}

button{
  width:100%;
  padding:10px;
  margin-bottom:10px;
  border:none;
  border-radius:6px;
  background:var(--primary);
  color:#fff;
  cursor:pointer;
  font-weight:600;
}

button.secondary{background:#334155}

/* MAPA (viewport) */
main{flex:1;padding:20px}

#mapa{
  position:relative;
  background:#fff;
  border:2px dashed var(--border);
  height:100%;
  border-radius:12px;
  overflow:hidden;
  cursor:grab;
}

/* CANVAS INFINITO */
#canvas{
  position:absolute;
  left:0;
  top:0;
  width:5000px;
  height:5000px;
  transform-origin:0 0;
}

/* MESA */
.mesa-wrapper{
  position:absolute;
  cursor:grab;
}

.mesa{
  position:absolute;
  background:#e5e7eb;
  border:2px solid #9ca3af;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:12px;
  font-weight:600;
  text-align:center;
}

.mesa.reservada{
  background:var(--green);
  color:#fff;
}

.selected .mesa{
  border-color:var(--primary);
}

/* FORMATOS */
.quadrada .mesa{width:60px;height:60px}
.retangular .mesa{width:90px;height:60px}
.redonda .mesa{border-radius:50%}

/* CADEIRAS */
.chair{
  position:absolute;
  width:18px;
  height:8px;
  background:var(--chair);
  border-radius:4px;
}

/* MODAL */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.4);
  display:none;
  align-items:center;
  justify-content:center;
}
.modal.active{display:flex}

.modal-box{
  background:#fff;
  padding:20px;
  width:320px;
  border-radius:10px;
}

.modal-box label{
  font-size:13px;
  margin-top:10px;
  display:block;
}

.modal-box input,select{
  width:100%;
  padding:8px;
  margin-top:4px;
}

.modal-actions{
  margin-top:15px;
  display:flex;
  gap:10px;
}
</style>
</head>

<body>

<aside>
  <h2>Mapa de Mesas</h2>
  <button onclick="abrirModalMesa()">‚ûï Adicionar Mesa</button>
  <button class="secondary" onclick="removerMesa()">üóëÔ∏è Remover Mesa</button>
</aside>

<main>
  <div id="mapa">
    <div id="canvas"></div>
  </div>
</main>

<!-- MODAIS (mantidos iguais) -->
<div class="modal" id="modalMesa">
  <div class="modal-box">
    <h3>Mesa</h3>

    <label>Nome</label>
    <input id="nomeMesa">

    <label>Tipo</label>
    <select id="tipoMesa" onchange="toggleRedonda()">
      <option value="quadrada">Quadrada</option>
      <option value="retangular">Retangular</option>
      <option value="redonda">Redonda</option>
    </select>

    <label id="labelRaio" style="display:none">Raio da mesa (px)</label>
    <input id="raioMesa" type="number" value="35" style="display:none">

    <label id="labelQtd" style="display:none">Quantidade de cadeiras</label>
    <input id="qtdCadeiras" type="number" value="6" min="1" style="display:none">

    <div class="modal-actions">
      <button onclick="salvarMesa()">Salvar</button>
      <button class="secondary" onclick="fecharModalMesa()">Cancelar</button>
    </div>
  </div>
</div>

<div class="modal" id="modalReserva">
  <div class="modal-box">
    <h3>Reserva</h3>

    <label>Cliente</label>
    <input id="clienteNome">

    <label>Telefone</label>
    <input id="clienteTelefone">

    <div class="modal-actions">
      <button onclick="salvarReserva()">Salvar</button>
      <button class="secondary" onclick="fecharModalReserva()">Cancelar</button>
    </div>
  </div>
</div>

<script>
const mapa=document.getElementById('mapa')
const canvas=document.getElementById('canvas')

let selecionada=null
let scale=1
let offsetX=0
let offsetY=0
let pan=false
let startX,startY

/* ZOOM */
mapa.addEventListener('wheel',e=>{
  e.preventDefault()
  scale+= e.deltaY * -0.001
  scale=Math.min(Math.max(.3,scale),3)
  atualizarTransform()
})

/* PAN */
mapa.addEventListener('mousedown',e=>{
  if(e.target!==mapa) return
  pan=true
  startX=e.clientX-offsetX
  startY=e.clientY-offsetY
})

window.addEventListener('mouseup',()=>pan=false)
window.addEventListener('mousemove',e=>{
  if(!pan) return
  offsetX=e.clientX-startX
  offsetY=e.clientY-startY
  atualizarTransform()
})

function atualizarTransform(){
  canvas.style.transform=`translate(${offsetX}px,${offsetY}px) scale(${scale})`
}

/* ===== MESA ===== */
function toggleRedonda(){
  const show=tipoMesa.value==='redonda'
  labelRaio.style.display=show?'block':'none'
  raioMesa.style.display=show?'block':'none'
  labelQtd.style.display=show?'block':'none'
  qtdCadeiras.style.display=show?'block':'none'
}

function abrirModalMesa(){
  nomeMesa.value=''
  tipoMesa.value='quadrada'
  raioMesa.value=35
  qtdCadeiras.value=6
  toggleRedonda()
  modalMesa.classList.add('active')
}

function fecharModalMesa(){modalMesa.classList.remove('active')}

function salvarMesa(){
  const wrap=document.createElement('div')
  wrap.className='mesa-wrapper '+tipoMesa.value
  wrap.style.left='2500px'
  wrap.style.top='2500px'

  const mesa=document.createElement('div')
  mesa.className='mesa'
  mesa.textContent=nomeMesa.value||'Mesa'

  if(tipoMesa.value==='redonda'){
    const r=Number(raioMesa.value)
    const qtd=Number(qtdCadeiras.value)
    mesa.style.width=r*2+'px'
    mesa.style.height=r*2+'px'
    criarCadeirasCirculo(wrap,r,qtd)
  }else{
    criarCadeirasLados(wrap,tipoMesa.value)
  }

  wrap.appendChild(mesa)
  canvas.appendChild(wrap)
  ativar(wrap,mesa)
  drag(wrap)
  fecharModalMesa()
}

function criarCadeirasLados(wrap,tipo){
  const pos= tipo==='retangular'
    ? [[36,-10],[36,60],[-10,26],[90,26]]
    : [[26,-10],[26,60]]

  pos.forEach(p=>{
    const c=document.createElement('div')
    c.className='chair'
    c.style.left=p[0]+'px'
    c.style.top=p[1]+'px'
    wrap.appendChild(c)
  })
}

function criarCadeirasCirculo(wrap,r,qtd){
  const dist=r+6
  for(let i=0;i<qtd;i++){
    const ang=(i/qtd)*Math.PI*2
    const c=document.createElement('div')
    c.className='chair'
    c.style.left=(r+Math.cos(ang)*dist)+'px'
    c.style.top =(r+Math.sin(ang)*dist)+'px'
    const rot=ang*(180/Math.PI)+90
    c.style.transform=`translate(-50%,-50%) rotate(${rot}deg)`
    wrap.appendChild(c)
  }
}

function ativar(wrap,mesa){
  wrap.onclick=()=>{
    document.querySelectorAll('.mesa-wrapper').forEach(m=>m.classList.remove('selected'))
    wrap.classList.add('selected')
    selecionada=wrap
  }
  wrap.ondblclick=()=>modalReserva.classList.add('active')
  wrap.mesa=mesa
}

function removerMesa(){
  if(selecionada){selecionada.remove();selecionada=null}
}

function salvarReserva(){
  if(!selecionada)return
  selecionada.mesa.classList.add('reservada')
  selecionada.mesa.textContent=clienteNome.value
  modalReserva.classList.remove('active')
}

function fecharModalReserva(){modalReserva.classList.remove('active')}

/* DRAG MESA */
function drag(el){
  let x=0,y=0
  el.onmousedown=e=>{
    e.stopPropagation()
    x=e.clientX;y=e.clientY
    document.onmousemove=ev=>{
      el.style.left=el.offsetLeft+(ev.clientX-x)/scale+'px'
      el.style.top =el.offsetTop +(ev.clientY-y)/scale+'px'
      x=ev.clientX;y=ev.clientY
    }
    document.onmouseup=()=>document.onmousemove=null
  }
}
</script>

</body>
</html>
