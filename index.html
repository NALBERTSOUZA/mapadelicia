<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Teste Supabase – mapa_mesas</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{
  font-family: Arial, sans-serif;
  padding:20px;
}
button{
  padding:10px 16px;
  margin-right:10px;
}
pre{
  background:#111;
  color:#0f0;
  padding:10px;
  margin-top:20px;
  max-height:300px;
  overflow:auto;
}
.error{ color:#ff4d4d; }
</style>
</head>

<body>

<h2>Teste Supabase – mapa_mesas</h2>

<button id="btnInserir">Inserir Registro</button>
<button id="btnListar">Listar Registros</button>

<pre id="log">Página carregada.</pre>

<script>
/* =================== TESTE JS =================== */
const logEl = document.getElementById('log')
const log = (msg, err=false)=>{
  logEl.className = err ? 'error' : ''
  logEl.textContent =
    typeof msg === 'string'
      ? msg
      : JSON.stringify(msg, null, 2)
}

log('JS carregado com sucesso ✅')

/* =================== SUPABASE =================== */
if(!window.supabase){
  log('ERRO: supabase não carregou do CDN', true)
  throw new Error('Supabase CDN não carregado')
}

const SUPABASE_URL = 'https://fzyosadzuvbktvmnzdpf.supabase.co'
const SUPABASE_ANON_KEY = 'sb_publishable_VuMi0uFLuzTAPdSL36uyNg_YhD_uPK0'

// ✅ NÃO USAR O NOME "supabase"
const db = window.supabase.createClient(
  SUPABASE_URL,
  SUPABASE_ANON_KEY
)

log('Supabase conectado ✅')

/* =================== BOTÕES =================== */
document.getElementById('btnInserir').onclick = inserir
document.getElementById('btnListar').onclick = listar

async function inserir(){
  log('Inserindo registro...')

  const { data, error } = await db
    .from('mapa_mesas')
    .insert({
      elemento_id: '71805376-fdae-44cd-a498-18e00cc86e37',
      x: Math.floor(Math.random()*500),
      y: Math.floor(Math.random()*300)
    })
    .select()

  if(error){
    log(error, true)
  }else{
    log(data)
  }
}

async function listar(){
  log('Buscando registros...')

  const { data, error } = await db
    .from('mapa_mesas')
    .select('*')
    .order('criado_em', { ascending:false })

  if(error){
    log(error, true)
  }else{
    log(data)
  }
}
</script>

</body>
</html>
